<!doctype html>
<html lang="en" data-vocs>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="/initializeTheme.iife.js"></script><title>x402 via EIP-3009 Forwarding â€“ thegreataxios blog</title><link rel="icon" href="/thegreataxios.png" type="image/png"/><meta property="og:type" content="website"/><meta property="og:title" content="x402 via EIP-3009 Forwarding"/><meta property="og:url" content="https://thegreataxios.com"/><meta name="twitter:card" content="summary_large_image"/>
    <script type="module" crossorigin src="/assets/index-Wzuqctek.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/style-B9W6MfBF.css">
  </head>
  <body>
    <div id="app"><base href="https://thegreataxios.com"/><div class="vocs_DocsLayout" data-layout="minimal"><a class="vocs_SkipLink vocs_utils_visuallyHidden" href="/blog/x402-via-eip3009-forwarding#vocs-content">Skip to content</a><div class="vocs_DocsLayout_gutterTop vocs_DocsLayout_gutterTop_sticky"><div class="vocs_DesktopTopNav vocs_DesktopTopNav_withLogo"><button class="vocs_DesktopSearch_search" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-_R_lj_" data-state="closed"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-top:2px"><path d="M10 6.5C10 8.433 8.433 10 6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5ZM9.30884 10.0159C8.53901 10.6318 7.56251 11 6.5 11C4.01472 11 2 8.98528 2 6.5C2 4.01472 4.01472 2 6.5 2C8.98528 2 11 4.01472 11 6.5C11 7.56251 10.6318 8.53901 10.0159 9.30884L12.8536 12.1464C13.0488 12.3417 13.0488 12.6583 12.8536 12.8536C12.6583 13.0488 12.3417 13.0488 12.1464 12.8536L9.30884 10.0159Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg>Search...<div class="vocs_DesktopSearch_searchCommand"><div style="background:currentColor;transform:rotate(45deg);width:1.5px;border-radius:2px;height:100%"></div></div></button><div class="vocs_DesktopTopNav_logoWrapper"><div class="vocs_DesktopTopNav_logo"><a style="align-items:center;display:flex;height:56px;margin-top:4px" href="/" data-discover="true"><div class="vocs_NavLogo_title">thegreataxios blog</div></a></div></div><div class="vocs_DesktopTopNav_section"></div><div class="vocs_DesktopTopNav_section"><div class="vocs_DesktopTopNav_group"><nav aria-label="Main" data-orientation="horizontal" dir="ltr" class="vocs_NavigationMenu"><div style="position:relative"><ul data-orientation="horizontal" class="vocs_NavigationMenu_list" dir="ltr"><a data-active="true" class="vocs_DesktopTopNav_item vocs_NavigationMenu_link vocs_Link vocs_Link_styleless" href="/" variant="styleless" data-radix-collection-item="" data-discover="true">Blog</a><a data-active="false" class="vocs_DesktopTopNav_item vocs_NavigationMenu_link vocs_Link vocs_Link_styleless" href="/my-projects" variant="styleless" data-radix-collection-item="" data-discover="true">My Projects</a><a data-active="false" class="vocs_DesktopTopNav_item vocs_NavigationMenu_link vocs_Link vocs_Link_styleless" href="/sponsor" variant="styleless" data-radix-collection-item="" data-discover="true">Sponsor</a><a class="vocs_DesktopTopNav_item vocs_NavigationMenu_link vocs_Link vocs_Link_styleless vocs_ExternalLink" href="https://buymeacoffee.com/thegreataxios" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)" data-active="false" variant="styleless" data-radix-collection-item="">Buy me a coffee</a><a class="vocs_DesktopTopNav_item vocs_NavigationMenu_link vocs_Link vocs_Link_styleless vocs_ExternalLink" href="https://x.com/thegreataxios" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)" data-active="false" variant="styleless" data-radix-collection-item="">Follow me on X</a></ul></div></nav></div></div></div><div class="vocs_MobileTopNav"><div class="vocs_MobileTopNav_section"><div class="vocs_MobileTopNav_group"><div class="vocs_MobileTopNav_logo"><a style="align-items:center;display:flex;height:100%" href="/" data-discover="true"><div class="vocs_NavLogo_title">thegreataxios blog</div></a></div></div><div class="vocs_MobileTopNav_group"><nav aria-label="Main" data-orientation="horizontal" dir="ltr" class="vocs_MobileTopNav_navigation vocs_NavigationMenu"><div style="position:relative"><ul data-orientation="horizontal" class="vocs_NavigationMenu_list" dir="ltr"><a data-active="true" class="vocs_NavigationMenu_link vocs_Link vocs_Link_styleless" href="/" variant="styleless" data-radix-collection-item="" data-discover="true">Blog</a><a data-active="false" class="vocs_NavigationMenu_link vocs_Link vocs_Link_styleless" href="/my-projects" variant="styleless" data-radix-collection-item="" data-discover="true">My Projects</a><a data-active="false" class="vocs_NavigationMenu_link vocs_Link vocs_Link_styleless" href="/sponsor" variant="styleless" data-radix-collection-item="" data-discover="true">Sponsor</a><a class="vocs_NavigationMenu_link vocs_Link vocs_Link_styleless vocs_ExternalLink" href="https://buymeacoffee.com/thegreataxios" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)" data-active="false" variant="styleless" data-radix-collection-item="">Buy me a coffee</a><a class="vocs_NavigationMenu_link vocs_Link vocs_Link_styleless vocs_ExternalLink" href="https://x.com/thegreataxios" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)" data-active="false" variant="styleless" data-radix-collection-item="">Follow me on X</a></ul></div></nav><div class="vocs_MobileTopNav_navigation vocs_MobileTopNav_navigation_compact"><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-_R_kpj_" data-state="closed" class="vocs_MobileTopNav_menuTrigger vocs_MobileTopNav_navigationItem">Blog<div aria-label="Menu" class="vocs_Icon" role="img" style="--vocs_Icon_size:16px"><svg width="100%" height="100%" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Chevron Down</title><path d="M3.13523 6.15803C3.3241 5.95657 3.64052 5.94637 3.84197 6.13523L7.5 9.56464L11.158 6.13523C11.3595 5.94637 11.6759 5.95657 11.8648 6.15803C12.0536 6.35949 12.0434 6.67591 11.842 6.86477L7.84197 10.6148C7.64964 10.7951 7.35036 10.7951 7.15803 10.6148L3.15803 6.86477C2.95657 6.67591 2.94637 6.35949 3.13523 6.15803Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></div></button></div></div></div><div class="vocs_MobileTopNav_section"><div class="vocs_MobileTopNav_group" style="margin-right:-8px"><button class="vocs_MobileSearch_searchButton" type="button" aria-label="Search" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-_R_19j_" data-state="closed"><svg width="21" height="21" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 6.5C10 8.433 8.433 10 6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5ZM9.30884 10.0159C8.53901 10.6318 7.56251 11 6.5 11C4.01472 11 2 8.98528 2 6.5C2 4.01472 4.01472 2 6.5 2C8.98528 2 11 4.01472 11 6.5C11 7.56251 10.6318 8.53901 10.0159 9.30884L12.8536 12.1464C13.0488 12.3417 13.0488 12.6583 12.8536 12.8536C12.6583 13.0488 12.3417 13.0488 12.1464 12.8536L9.30884 10.0159Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button></div></div></div></div><div class="vocs_DocsLayout_gutterTopCurtain vocs_DocsLayout_gutterTopCurtain_hidden"><div class="vocs_DesktopTopNav_curtain"></div><div class="vocs_MobileTopNav_curtain"><div class="vocs_MobileTopNav_curtainGroup"><div class="vocs_MobileTopNav_curtainItem">x402 via EIP-3009 Forwarding</div></div><div class="vocs_MobileTopNav_curtainGroup"></div></div></div><div id="vocs-content" class="vocs_DocsLayout_content vocs_DocsLayout_content_withTopNav"><article class="vocs_Content"><header class="vocs_Header"><h1 class="vocs_H1 vocs_Heading"><div id="x402-via-eip-3009-forwarding" class="vocs_Heading_slugTarget"></div>x402 via EIP-3009 Forwarding<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#x402-via-eip-3009-forwarding" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h1></header>
<p class="vocs_Paragraph">x402 is Coinbase&#x27;s open protocol for internet-native payments that enables seamless blockchain transactions using ERC-3009 USDC. This article explores how to extend x402 to any blockchain through EIP-3009 forwarding contracts, with a focus on SKALE Network&#x27;s zero-gas infrastructure that enables instant, cost-free transactions across any token on EVM-compatible chains.</p>
<p class="vocs_Paragraph">x402 is an open protocol for internet native payments created at Coinbase. Coinbase has been deeply aligned with Circle, and chose to build x402 process around the the use of ERC-3009 native USDC.</p>
<p class="vocs_Paragraph">With an increasing number of blockchains being created, many of which are utilizing bridged assets instead of official deployments from stablecoin issuers, this article explores ERC-3009, forwarding payments with ERC-3009 Forwarder, implementing with minimal facilitator changes, and more.</p>
<p class="vocs_Paragraph">While enables x402 on any blockchain, a major unlock of this initiative was to bring x402 to SKALE, the only network of infinite block space with zero gas fees and instant finality.</p>
<h2 class="vocs_H2 vocs_Heading"><div id="technology-overview" class="vocs_Heading_slugTarget"></div>Technology Overview<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#technology-overview" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h2>
<p class="vocs_Paragraph">The following section provides an introduction to x402, blockchains, SKALE Network, stablecoins and tokenization, ERC-3009, and the ERC-3009 Forwarder. If you are already familiar with these topics and want to skip to the implementation, click <a class="vocs_Anchor" href="/blog/x402-via-eip3009-forwarding#implementation">here</a>.</p>
<h3 class="vocs_H3 vocs_Heading"><div id="x402" class="vocs_Heading_slugTarget"></div>x402<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#x402" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h3>
<p class="vocs_Paragraph"><a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://x402.org" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">x402</a> by Coinbase is an open protocol for internet native payments. This allows for access to be given to resources in a new manner; without the need for traditional login/registration, OAuth, or complex registration. It also bakes monetization directly into the flow for resource access.</p>
<p class="vocs_Paragraph">Specifically, x402 is blockchain agnostic and runs at the speed of blockchain. The faster the blockchain, the faster your payment. While designed for digital dollars, the standard is technically agnostic to allow for any token to be used as payment.</p>
<p class="vocs_Paragraph">Additionally, it was built with a number of key use cases in mind such as agentic payments to allow for real time API access to resources, micro transactions for access and creation of content, and more broadly a native integration into any web based service allowing for monetization to occur without a middleman.</p>
<h3 class="vocs_H3 vocs_Heading"><div id="skale" class="vocs_Heading_slugTarget"></div>SKALE<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#skale" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h3>
<p class="vocs_Paragraph"><a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://skale.space" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">SKALE</a> is a network of blockchains capable of bringing an infinite amount of block space to the world in the form of SKALE Chains. SKALE Chains are EVM compatible blockchains that are run by the pool of SKALE validator nodes. With a unique economic model that allows communities, developers, businesses, enterprises, and governments to purchase their own blockchains for  a flat fee, the underlying SKALE Chain can be configured and utilized in whatever way they see fit, including zero gas fee transactions.</p>
<p class="vocs_Paragraph">With the instant finality, large block size, and zero gas fee nature of a SKALE Chain; it&#x27;s an ideal fit to bring zero cost operations to x402 for every token; a far greater opportunity for developers and stablecoin issuers compared to using subsidized USDC on certain chains.</p>
<h3 class="vocs_H3 vocs_Heading"><div id="stablecoins" class="vocs_Heading_slugTarget"></div>Stablecoins<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#stablecoins" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h3>
<p class="vocs_Paragraph">If you are unfamiliar with stablecoins, they are a cryptocurrency designed to remain at a stable value in relation to some other asset. The largest stablecoins today are Tether USD (USDT) and Circle USD (USDC) which are tokens issued by their respective companies intended to stay pegged at the value of $1 USD per token.</p>
<p class="vocs_Paragraph">The usage of stablecoins within x402 makes a lot of sense for many of the core use cases called out such as for cloud compute and storage providers. Stablecoins with zero gas fees is an even stronger pull to providers who don&#x27;t have to weigh the cost of gas into their services.</p>
<h3 class="vocs_H3 vocs_Heading"><div id="erc-3009--forwarding-contract" class="vocs_Heading_slugTarget"></div>ERC-3009 &amp; Forwarding Contract<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#erc-3009--forwarding-contract" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h3>
<p class="vocs_Paragraph">ERC-3009 allows the transfer of fungible assets through signed authorization. Through the use of meta-transactions, signatures are used to approve the movement of assets. This brings with it many unique benefits which are explored in the official <a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://eips.ethereum.org/EIPS/eip-3009" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">EIP-3009</a>.</p>
<p class="vocs_Paragraph">The unique part about 3009, is that it&#x27;s actually implemented within a few stablecoins, such as USDC and EURC by Circle, but very few others. While this limits blockchains and tokens without ERC-3009 native tokens, it does not stop us from moving forward.</p>
<p class="vocs_Paragraph">While there are a number of ways to implement the meta-transactions, for to start I chose to go with a <strong class="vocs_Strong">Forwarding</strong> contract for ERC-3009 since that is what the majority of facilitators are currently offering. My belief is that when a technology is new we can always explore more complex and fine-tuned designs, however, the easier it is to integrate into existing tooling the faster we can bring the usage over to SKALE and everyone can benefit from the zero gas fees.</p>
<blockquote class="vocs_Blockquote">
<p class="vocs_Paragraph">The current forwarding contract is not audited. This contract is offered without any guarantees or warranties under the MIT License. See the full license <a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://github.com/TheGreatAxios/eip3009-wrapper/blob/main/LICENSE" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">here</a>.</p>
</blockquote>
<h2 class="vocs_H2 vocs_Heading"><div id="implementation" class="vocs_Heading_slugTarget"></div>Implementation<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#implementation" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h2>
<p class="vocs_Paragraph">The following section explores all the code written and steps taken to achieve a working implementation.</p>
<h3 class="vocs_H3 vocs_Heading"><div id="forwarding-payments-with-erc-3009" class="vocs_Heading_slugTarget"></div>Forwarding Payments with ERC-3009<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#forwarding-payments-with-erc-3009" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h3>
<p class="vocs_Paragraph">The entire setup of facilitators currently relies on ERC-3009 compatible tokens, i.e USDC.
Therefore, to ensure that we could utilize as much of the existing facilitator as possible we needed to implement a <code class="vocs_Code">Forwarding</code> contract. While slightly more inefficient, the gas costs are irrelevant on a chain like SKALE and the extra approval is a price worth paying to achieve my goal (I can iron it out later).</p>
<p class="vocs_Paragraph">I created the <a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://github.com/TheGreatAxios/eip3009-forwarder" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">EIP-3009 Forwarder</a> which uses the core structure of the core proposal, but through a forwarding contract. <em>The difference?</em> The sender who is signing the authorization must first approve the token being spent via authorization.</p>
<p class="vocs_Paragraph">As mentioned above, I think this is an acceptable tradeoff. This specific forwarding contract is designed to support a single token only. This was again done to mimic the setup and flows of a traditional facilitator.</p>
<h3 class="vocs_H3 vocs_Heading"><div id="x402-example-scripts" class="vocs_Heading_slugTarget"></div>x402 Example Scripts<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#x402-example-scripts" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h3>
<p class="vocs_Paragraph">Once the forwarding contract was built with a small test suite, it made sense to ensure this worked directly. I then setup a <code class="vocs_Code">Bun</code> mono-repo <a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://github.com/TheGreatAxios/x402-examples" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">here</a> which has a config folder and an ethers-v6 example.</p>
<p class="vocs_Paragraph">Make note of the first key step within the script below, which is the approval checks and approve as needed functionality.</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><button class="vocs_CopyButton" data-copied="false" type="button"><div aria-label="Copy" class="vocs_Icon" role="img" style="--vocs_Icon_size:18px"><svg width="100%" height="100%" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Copy</title><path d="M5 2V1H10V2H5ZM4.75 0C4.33579 0 4 0.335786 4 0.75V1H3.5C2.67157 1 2 1.67157 2 2.5V12.5C2 13.3284 2.67157 14 3.5 14H7V13H3.5C3.22386 13 3 12.7761 3 12.5V2.5C3 2.22386 3.22386 2 3.5 2H4V2.25C4 2.66421 4.33579 3 4.75 3H10.25C10.6642 3 11 2.66421 11 2.25V2H11.5C11.7761 2 12 2.22386 12 2.5V7H13V2.5C13 1.67157 12.3284 1 11.5 1H11V0.75C11 0.335786 10.6642 0 10.25 0H4.75ZM9 8.5C9 8.77614 8.77614 9 8.5 9C8.22386 9 8 8.77614 8 8.5C8 8.22386 8.22386 8 8.5 8C8.77614 8 9 8.22386 9 8.5ZM10.5 9C10.7761 9 11 8.77614 11 8.5C11 8.22386 10.7761 8 10.5 8C10.2239 8 10 8.22386 10 8.5C10 8.77614 10.2239 9 10.5 9ZM13 8.5C13 8.77614 12.7761 9 12.5 9C12.2239 9 12 8.77614 12 8.5C12 8.22386 12.2239 8 12.5 8C12.7761 8 13 8.22386 13 8.5ZM14.5 9C14.7761 9 15 8.77614 15 8.5C15 8.22386 14.7761 8 14.5 8C14.2239 8 14 8.22386 14 8.5C14 8.77614 14.2239 9 14.5 9ZM15 10.5C15 10.7761 14.7761 11 14.5 11C14.2239 11 14 10.7761 14 10.5C14 10.2239 14.2239 10 14.5 10C14.7761 10 15 10.2239 15 10.5ZM14.5 13C14.7761 13 15 12.7761 15 12.5C15 12.2239 14.7761 12 14.5 12C14.2239 12 14 12.2239 14 12.5C14 12.7761 14.2239 13 14.5 13ZM14.5 15C14.7761 15 15 14.7761 15 14.5C15 14.2239 14.7761 14 14.5 14C14.2239 14 14 14.2239 14 14.5C14 14.7761 14.2239 15 14.5 15ZM8.5 11C8.77614 11 9 10.7761 9 10.5C9 10.2239 8.77614 10 8.5 10C8.22386 10 8 10.2239 8 10.5C8 10.7761 8.22386 11 8.5 11ZM9 12.5C9 12.7761 8.77614 13 8.5 13C8.22386 13 8 12.7761 8 12.5C8 12.2239 8.22386 12 8.5 12C8.77614 12 9 12.2239 9 12.5ZM8.5 15C8.77614 15 9 14.7761 9 14.5C9 14.2239 8.77614 14 8.5 14C8.22386 14 8 14.2239 8 14.5C8 14.7761 8.22386 15 8.5 15ZM11 14.5C11 14.7761 10.7761 15 10.5 15C10.2239 15 10 14.7761 10 14.5C10 14.2239 10.2239 14 10.5 14C10.7761 14 11 14.2239 11 14.5ZM12.5 15C12.7761 15 13 14.7761 13 14.5C13 14.2239 12.7761 14 12.5 14C12.2239 14 12 14.2239 12 14.5C12 14.7761 12.2239 15 12.5 15Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></div></button><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// ===================</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// STEP A: User approves ERC-20 (with smart allowance check)</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// ===================</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">console.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">log</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;Step A: Checking and setting allowance&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> approveAmount</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> ethers.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">parseUnits</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;1&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, token.decimals); </span><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// 1 token</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> currentAllowance</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> erc20Contract.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">allowance</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(userAddress, </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">FORWARDER_ADDRESS</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> minimumRequired</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (approveAmount </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">*</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 20</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">n</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">/</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 100</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">n</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">; </span><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// 20% of approve amount</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">console.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">log</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">`Current allowance: ${</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">ethers</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">formatUnits</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">(</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">currentAllowance</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">, </span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">token</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">decimals</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">)</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">console.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">log</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">`Minimum required (20%): ${</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">ethers</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">formatUnits</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">(</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">minimumRequired</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">, </span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">token</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">decimals</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">)</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">if</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (currentAllowance </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">&lt;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> minimumRequired) {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">	console.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">log</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;Insufficient allowance, approving...&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> approveTx</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> erc20Contract.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">approve</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">FORWARDER_ADDRESS</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, approveAmount);</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	await</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> approveTx.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">wait</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">();</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">	console.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">log</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">`âœ“ Approved! Tx: ${</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">approveTx</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">hash</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">} </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">else</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">	console.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">log</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;âœ“ Sufficient allowance exists, skipping approval&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">}</span></span></code></pre></div></div>
<p class="vocs_Paragraph">This code ensures some amount is approved to the forwarder in advance which can then be used for micro-transactions.</p>
<blockquote class="vocs_Blockquote">
<p class="vocs_Paragraph">I think in these cases it&#x27;s an acceptable flow for agents as they can do a single approval for small batches i.e $10 of $0.01 gets you 1000 transactions.</p>
</blockquote>
<p class="vocs_Paragraph">You can deploy the forwarding contract and play with these scripts directly. The example script working to execute a USDC (without ERC-3009) payment on SKALE Europa Testnet can be seen here:</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><button class="vocs_CopyButton" data-copied="false" type="button"><div aria-label="Copy" class="vocs_Icon" role="img" style="--vocs_Icon_size:18px"><svg width="100%" height="100%" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Copy</title><path d="M5 2V1H10V2H5ZM4.75 0C4.33579 0 4 0.335786 4 0.75V1H3.5C2.67157 1 2 1.67157 2 2.5V12.5C2 13.3284 2.67157 14 3.5 14H7V13H3.5C3.22386 13 3 12.7761 3 12.5V2.5C3 2.22386 3.22386 2 3.5 2H4V2.25C4 2.66421 4.33579 3 4.75 3H10.25C10.6642 3 11 2.66421 11 2.25V2H11.5C11.7761 2 12 2.22386 12 2.5V7H13V2.5C13 1.67157 12.3284 1 11.5 1H11V0.75C11 0.335786 10.6642 0 10.25 0H4.75ZM9 8.5C9 8.77614 8.77614 9 8.5 9C8.22386 9 8 8.77614 8 8.5C8 8.22386 8.22386 8 8.5 8C8.77614 8 9 8.22386 9 8.5ZM10.5 9C10.7761 9 11 8.77614 11 8.5C11 8.22386 10.7761 8 10.5 8C10.2239 8 10 8.22386 10 8.5C10 8.77614 10.2239 9 10.5 9ZM13 8.5C13 8.77614 12.7761 9 12.5 9C12.2239 9 12 8.77614 12 8.5C12 8.22386 12.2239 8 12.5 8C12.7761 8 13 8.22386 13 8.5ZM14.5 9C14.7761 9 15 8.77614 15 8.5C15 8.22386 14.7761 8 14.5 8C14.2239 8 14 8.22386 14 8.5C14 8.77614 14.2239 9 14.5 9ZM15 10.5C15 10.7761 14.7761 11 14.5 11C14.2239 11 14 10.7761 14 10.5C14 10.2239 14.2239 10 14.5 10C14.7761 10 15 10.2239 15 10.5ZM14.5 13C14.7761 13 15 12.7761 15 12.5C15 12.2239 14.7761 12 14.5 12C14.2239 12 14 12.2239 14 12.5C14 12.7761 14.2239 13 14.5 13ZM14.5 15C14.7761 15 15 14.7761 15 14.5C15 14.2239 14.7761 14 14.5 14C14.2239 14 14 14.2239 14 14.5C14 14.7761 14.2239 15 14.5 15ZM8.5 11C8.77614 11 9 10.7761 9 10.5C9 10.2239 8.77614 10 8.5 10C8.22386 10 8 10.2239 8 10.5C8 10.7761 8.22386 11 8.5 11ZM9 12.5C9 12.7761 8.77614 13 8.5 13C8.22386 13 8 12.7761 8 12.5C8 12.2239 8.22386 12 8.5 12C8.77614 12 9 12.2239 9 12.5ZM8.5 15C8.77614 15 9 14.7761 9 14.5C9 14.2239 8.77614 14 8.5 14C8.22386 14 8 14.2239 8 14.5C8 14.7761 8.22386 15 8.5 15ZM11 14.5C11 14.7761 10.7761 15 10.5 15C10.2239 15 10 14.7761 10 14.5C10 14.2239 10.2239 14 10.5 14C10.7761 14 11 14.2239 11 14.5ZM12.5 15C12.7761 15 13 14.7761 13 14.5C13 14.2239 12.7761 14 12.5 14C12.2239 14 12 14.2239 12 14.5C12 14.7761 12.2239 15 12.5 15Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></div></button><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Step</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> A:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> Checking</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> and</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> setting</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> allowance</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Current</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> allowance:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 999999999999.78</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Minimum</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> required</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (20%): 0.2</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">âœ“</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> Sufficient</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> allowance</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> exists,</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> skipping</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> approval</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">User</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> balance:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 49.78</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> USDC</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Step</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> B:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> User</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> signs</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> authorization</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> for</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 0.01</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> token</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> transfer</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Nonce:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 0x94c1a3e2f911070928b2d1cee1c31736decabe7ac044b020f4b808806b58eb8b</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Valid</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> from:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> 2025-10-04T05:34:14.000Z</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Valid</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> until:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> 2025-10-04T06:34:14.000Z</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Nonce</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> already</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> used:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> false</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Domain</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> separator:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 0x056b9108f4b1e6aca877b44e3afa782d7a46328ecb25ee6d4eb037c02cfeaaa0</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Domain:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">  name:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;USDC Forwarder&quot;,</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">  version:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;1&quot;,</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">  chainId:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> 1444673419,</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">  verifyingContract:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;0x7779B0d1766e6305E5f8081E3C0CDF58FcA24330&quot;,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">}</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Authorization</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> value:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">  from:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;0xdEAC50014a531969d76D9236d209912F4B1AacDB&quot;,</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">  to:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;0xD1A64e20e93E088979631061CACa74E08B3c0f55&quot;,</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">  value:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;0.01 (10000)&quot;,</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">  validAfter:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> 1759556054,</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">  validBefore:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> 1759559654,</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">  nonce:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;0x94c1a3e2f911070928b2d1cee1c31736decabe7ac044b020f4b808806b58eb8b&quot;,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">}</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">âœ“</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> User</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> signed</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> authorization:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> 0xa8e092aea8b4b0001d...</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Signature</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> components:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> v=28,</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> r=0xa8e092aea8b4b0001dd9e1f72c718855e0ff0b91668dd9d92ba3df474b051370,</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> s=</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">0x3f1380d002c243e432f2292aaed3bac5cb64b1f4a494e128d6e3fa33e722cfa7</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Step</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> C:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> Relayer</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> executes</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> the</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> transfer</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (pays </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">gas</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Final</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> allowance</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> check:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 999999999999.78</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">âœ“</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> Transfer</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> executed!</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> Tx:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 0x6e0da427fa6976cbc3100f155c77113fc2508249fcb042763baeb3af264370da</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">âœ“</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> Gas</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> paid</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> by</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> relayer:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 92297</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> units</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">âœ“</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 0.01</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> tokens</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> transferred</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> from</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 0xdEAC50014a531969d76D9236d209912F4B1AacDB</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> to</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 0xD1A64e20e93E088979631061CACa74E08B3c0f55</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">ðŸŽ‰</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> Gasless</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> transfer</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> complete!</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">-</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> User</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> paid</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> 0</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> gas</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> for</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> the</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> transfer</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">-</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> Relayer</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> paid</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> the</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> gas</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> fees</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">-</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> Transfer</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> executed</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> via</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> signed</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> authorization</span></span></code></pre></div></div>
<h3 class="vocs_H3 vocs_Heading"><div id="minimal-facilitator-modifications" class="vocs_Heading_slugTarget"></div>Minimal Facilitator Modifications<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#minimal-facilitator-modifications" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h3>
<p class="vocs_Paragraph">The facilitator is an optional service within the x402 flow that simplifies the process of verifying and settling payments. While optional, it can help accelerate the adoption and addition of x402 into applications that don&#x27;t have the experience or the resources to build the necessary functionality.</p>
<p class="vocs_Paragraph">The two key functions that a facilitator offers are:</p>
<ol class="vocs_List vocs_List_ordered">
<li class="vocs_ListItem">Verification of payment payloads submitted by clients (buyers).</li>
<li class="vocs_ListItem">Settling of payments on the blockchain on behalf of the servers</li>
</ol>
<p class="vocs_Paragraph">This enables any web server to utilize the blockchain to handle payments and settlement without the need of direct connection to the blockchain within their existing servers.</p>
<p class="vocs_Paragraph">The majority of facilitators (and x402 payments) have been focused on Base so far. While Coinbase/Base may be subsidizing all gas fees for USDC transactions making x402 cheap, there are no guarantees that lasts forever OR benefits toward non-USDC stablecoins and tokens.</p>
<p class="vocs_Paragraph">With the core protocol being built around the usage of USDC to start, the facilitators are utilizing an Ethereum Improvement Proposal (EIP) labeled EIP-3009 which allows transfer with authorization; further extending EIP-712 signatures and meta-transactions directly within the token contract.</p>
<p class="vocs_Paragraph">However, as not all blockchains are able to attain a native deployment by Circle and with many existing stablecoins like USDT not being natively EIP-3009 compatible, I set out to ensure that that facilitators could work with any token with minimal modifications.</p>
<p class="vocs_Paragraph">The proposed changes include using an <a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://github.com/thegreataxios/eip3009-forwarder" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)"><code class="vocs_Code">EIP-3009 Forwarder</code></a> smart contract in Solidity which wallets can approve to spend tokens on their behalf. With such a design, it allows any token on any blockchain to be utilized with almost no changes to an EVM facilitator as the current flows remain almost identical.</p>
<p class="vocs_Paragraph">To prove this, I made a <a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://github.com/faremeter/faremeter/pull/58" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">pull request</a> to Faremeter by <a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://corbits.dev" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">Corbits</a> to add support to their facilitator. The majority of changes come from additional configuration as you can see in the following:</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><button class="vocs_CopyButton" data-copied="false" type="button"><div aria-label="Copy" class="vocs_Icon" role="img" style="--vocs_Icon_size:18px"><svg width="100%" height="100%" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Copy</title><path d="M5 2V1H10V2H5ZM4.75 0C4.33579 0 4 0.335786 4 0.75V1H3.5C2.67157 1 2 1.67157 2 2.5V12.5C2 13.3284 2.67157 14 3.5 14H7V13H3.5C3.22386 13 3 12.7761 3 12.5V2.5C3 2.22386 3.22386 2 3.5 2H4V2.25C4 2.66421 4.33579 3 4.75 3H10.25C10.6642 3 11 2.66421 11 2.25V2H11.5C11.7761 2 12 2.22386 12 2.5V7H13V2.5C13 1.67157 12.3284 1 11.5 1H11V0.75C11 0.335786 10.6642 0 10.25 0H4.75ZM9 8.5C9 8.77614 8.77614 9 8.5 9C8.22386 9 8 8.77614 8 8.5C8 8.22386 8.22386 8 8.5 8C8.77614 8 9 8.22386 9 8.5ZM10.5 9C10.7761 9 11 8.77614 11 8.5C11 8.22386 10.7761 8 10.5 8C10.2239 8 10 8.22386 10 8.5C10 8.77614 10.2239 9 10.5 9ZM13 8.5C13 8.77614 12.7761 9 12.5 9C12.2239 9 12 8.77614 12 8.5C12 8.22386 12.2239 8 12.5 8C12.7761 8 13 8.22386 13 8.5ZM14.5 9C14.7761 9 15 8.77614 15 8.5C15 8.22386 14.7761 8 14.5 8C14.2239 8 14 8.22386 14 8.5C14 8.77614 14.2239 9 14.5 9ZM15 10.5C15 10.7761 14.7761 11 14.5 11C14.2239 11 14 10.7761 14 10.5C14 10.2239 14.2239 10 14.5 10C14.7761 10 15 10.2239 15 10.5ZM14.5 13C14.7761 13 15 12.7761 15 12.5C15 12.2239 14.7761 12 14.5 12C14.2239 12 14 12.2239 14 12.5C14 12.7761 14.2239 13 14.5 13ZM14.5 15C14.7761 15 15 14.7761 15 14.5C15 14.2239 14.7761 14 14.5 14C14.2239 14 14 14.2239 14 14.5C14 14.7761 14.2239 15 14.5 15ZM8.5 11C8.77614 11 9 10.7761 9 10.5C9 10.2239 8.77614 10 8.5 10C8.22386 10 8 10.2239 8 10.5C8 10.7761 8.22386 11 8.5 11ZM9 12.5C9 12.7761 8.77614 13 8.5 13C8.22386 13 8 12.7761 8 12.5C8 12.2239 8.22386 12 8.5 12C8.77614 12 9 12.2239 9 12.5ZM8.5 15C8.77614 15 9 14.7761 9 14.5C9 14.2239 8.77614 14 8.5 14C8.22386 14 8 14.2239 8 14.5C8 14.7761 8.22386 15 8.5 15ZM11 14.5C11 14.7761 10.7761 15 10.5 15C10.2239 15 10 14.7761 10 14.5C10 14.2239 10.2239 14 10.5 14C10.7761 14 11 14.2239 11 14.5ZM12.5 15C12.7761 15 13 14.7761 13 14.5C13 14.2239 12.7761 14 12.5 14C12.2239 14 12 14.2239 12 14.5C12 14.7761 12.2239 15 12.5 15Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></div></button><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">type</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> NetworkInfo</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">	address</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Address</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">	contractName</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">	/* Added Below */</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">	forwarder</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">?:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Address</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">	forwarderName</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">?:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">	forwarderVersion</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">?:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">};</span></span></code></pre></div></div>
<p class="vocs_Paragraph">The most complicated changes were needed within the actual EVM facilitator code, of which the original changes were actually pretty light. They simply had to allow the facilitator to defer to a forwarder when present else fallback to the actual ERC-20 with ERC-3009 support.</p>
<p class="vocs_Paragraph">I wound up refactoring the whole file to better re-use code, but an example here:</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><button class="vocs_CopyButton" data-copied="false" type="button"><div aria-label="Copy" class="vocs_Icon" role="img" style="--vocs_Icon_size:18px"><svg width="100%" height="100%" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Copy</title><path d="M5 2V1H10V2H5ZM4.75 0C4.33579 0 4 0.335786 4 0.75V1H3.5C2.67157 1 2 1.67157 2 2.5V12.5C2 13.3284 2.67157 14 3.5 14H7V13H3.5C3.22386 13 3 12.7761 3 12.5V2.5C3 2.22386 3.22386 2 3.5 2H4V2.25C4 2.66421 4.33579 3 4.75 3H10.25C10.6642 3 11 2.66421 11 2.25V2H11.5C11.7761 2 12 2.22386 12 2.5V7H13V2.5C13 1.67157 12.3284 1 11.5 1H11V0.75C11 0.335786 10.6642 0 10.25 0H4.75ZM9 8.5C9 8.77614 8.77614 9 8.5 9C8.22386 9 8 8.77614 8 8.5C8 8.22386 8.22386 8 8.5 8C8.77614 8 9 8.22386 9 8.5ZM10.5 9C10.7761 9 11 8.77614 11 8.5C11 8.22386 10.7761 8 10.5 8C10.2239 8 10 8.22386 10 8.5C10 8.77614 10.2239 9 10.5 9ZM13 8.5C13 8.77614 12.7761 9 12.5 9C12.2239 9 12 8.77614 12 8.5C12 8.22386 12.2239 8 12.5 8C12.7761 8 13 8.22386 13 8.5ZM14.5 9C14.7761 9 15 8.77614 15 8.5C15 8.22386 14.7761 8 14.5 8C14.2239 8 14 8.22386 14 8.5C14 8.77614 14.2239 9 14.5 9ZM15 10.5C15 10.7761 14.7761 11 14.5 11C14.2239 11 14 10.7761 14 10.5C14 10.2239 14.2239 10 14.5 10C14.7761 10 15 10.2239 15 10.5ZM14.5 13C14.7761 13 15 12.7761 15 12.5C15 12.2239 14.7761 12 14.5 12C14.2239 12 14 12.2239 14 12.5C14 12.7761 14.2239 13 14.5 13ZM14.5 15C14.7761 15 15 14.7761 15 14.5C15 14.2239 14.7761 14 14.5 14C14.2239 14 14 14.2239 14 14.5C14 14.7761 14.2239 15 14.5 15ZM8.5 11C8.77614 11 9 10.7761 9 10.5C9 10.2239 8.77614 10 8.5 10C8.22386 10 8 10.2239 8 10.5C8 10.7761 8.22386 11 8.5 11ZM9 12.5C9 12.7761 8.77614 13 8.5 13C8.22386 13 8 12.7761 8 12.5C8 12.2239 8.22386 12 8.5 12C8.77614 12 9 12.2239 9 12.5ZM8.5 15C8.77614 15 9 14.7761 9 14.5C9 14.2239 8.77614 14 8.5 14C8.22386 14 8 14.2239 8 14.5C8 14.7761 8.22386 15 8.5 15ZM11 14.5C11 14.7761 10.7761 15 10.5 15C10.2239 15 10 14.7761 10 14.5C10 14.2239 10.2239 14 10.5 14C10.7761 14 11 14.2239 11 14.5ZM12.5 15C12.7761 15 13 14.7761 13 14.5C13 14.2239 12.7761 14 12.5 14C12.2239 14 12 14.2239 12 14.5C12 14.7761 12.2239 15 12.5 15Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></div></button><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">async</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> function</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> createContractConfig</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  useForwarder</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> boolean</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  chainId</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> number</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  forwarderVersion</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> |</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> undefined</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  forwarderName</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> |</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> undefined</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  forwarderAddress</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> `0x${</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">string</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> |</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> undefined</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  publicClient</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> PublicClient</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  asset</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> `0x${</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">string</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  contractName</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Promise</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&lt;</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">ContractConfig</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&gt; {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> address</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> getContractAddress</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(useForwarder, forwarderAddress, asset);</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> domain</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> useForwarder</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    ?</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> generateForwarderDomain</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(chainId, {</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">        version: forwarderVersion</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">!</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">        name: forwarderName</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">!</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">        verifyingContract: forwarderAddress</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">!</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">      })</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    :</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> generateDomain</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(publicClient, chainId, asset);</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">  // Validate contract name for non-forwarder cases</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  if</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">!</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">useForwarder </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">&amp;&amp;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> domain.name </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">!==</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> contractName) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    throw</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Error</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">      `On chain contract name (${</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">domain</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">name</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}) doesn&#x27;t match configured asset name (${</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">contractName</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">})`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    );</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  }</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  return</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { address, domain };</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">}</span></span></code></pre></div></div>
<p class="vocs_Paragraph">from <a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://github.com/faremeter/faremeter/blob/76f2e79ee2906ae4e60330186c350bfd31e520a1/packages/payment-evm/src/exact/facilitator.ts#L81" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">here</a> showcases the dynamic use of <code class="vocs_Code">useForwarder</code>.</p>
<p class="vocs_Paragraph">When the facilitator is called, it uses the incoming configuration of token and chain to validate if the forwarder is needed. After which the core facilitation stays 1:1 as the actual EIP-712 signature validation and then meta-transaction execution remains identical.</p>
<h3 class="vocs_H3 vocs_Heading"><div id="why-x402-on-skale" class="vocs_Heading_slugTarget"></div>Why x402 on SKALE<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#why-x402-on-skale" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h3>
<blockquote class="vocs_Blockquote">
<p class="vocs_Paragraph">This section is opinionated.</p>
</blockquote>
<p class="vocs_Paragraph"><strong class="vocs_Strong">&quot;Why SKALE?&quot;</strong> is a question that I have been getting asked for over 4.5 years now (as of 10/1/2025). I think as a developer you find your preferred tech stacks and for everyone it&#x27;s a bit different. SKALE however really is unique. The combination of performance, stability, innovation, and feature set is unmatched across the Web3 space.</p>
<p class="vocs_Paragraph">In the case of x402 -- there is quite literally no network better suited to dominate. I&#x27;ve been asking developers building what they value most with x402. The answer is always one of two things:</p>
<ol class="vocs_List vocs_List_ordered">
<li class="vocs_ListItem">The cheapest costs possible (i.e gas fees) which allows facilitators to reduce their opex and not have to pass it onto buyers as service fees</li>
<li class="vocs_ListItem">Speed. Speed. Speed. They want the chain to be fast and they are prioritizing real finality when possible (i.e Solana &gt; Base).</li>
</ol>
<p class="vocs_Paragraph">If you were unaware:</p>
<ol class="vocs_List vocs_List_ordered">
<li class="vocs_ListItem">SKALE Chains have zero gas fees</li>
</ol>
<blockquote class="vocs_Blockquote">
<p class="vocs_Paragraph">This doesn&#x27;t mean that SKALE doesn&#x27;t make money. SKALE Chains are pre-paid monthly by application and chain owners. No different than many of the most successful cloud models in the world like Amazon Web Services or Google Cloud</p>
</blockquote>
<ol start="2" class="vocs_List vocs_List_ordered">
<li class="vocs_ListItem">Instant Finality</li>
</ol>
<blockquote class="vocs_Blockquote">
<p class="vocs_Paragraph">Once a transaction is posted, the block and transactions cannot be reversed. The fork-less nature of a SKALE Chain means that current chains which operate around 1-2s block times are faster most L1s and retain better finality with lower risk. Additionally, smaller SKALE Chains with co-located nodes (think Hyperliquid style) could reduce this down to potentially a fraction of the time with instant finality.</p>
</blockquote>
<p class="vocs_Paragraph">Additionally, the last thing is scalability. While some blockchains today may have the capacity for handling a few thousand transactions per second or peaks of higher; the whole world will never run on a single blockchain (for many reasons).</p>
<p class="vocs_Paragraph">SKALE also makes it possible to run an infinite amount of blockchains for x402, payments, stablecoins, and the broader onchain finance landscape as it continues to grow.</p>
<h2 class="vocs_H2 vocs_Heading"><div id="conclusion" class="vocs_Heading_slugTarget"></div>Conclusion<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/blog/x402-via-eip3009-forwarding#conclusion" data-discover="true"><div data-autolink-icon="true" class="vocs_Div"></div></a></h2>
<p class="vocs_Paragraph">I think x402 is one of many recent protocols that is incredibly exciting for the future of the machine economy. I previously wrote <a class="vocs_Anchor vocs_Link vocs_Link_accent" href="/blog/the-rise-of-the-machine-economy" data-discover="true">The Rise of the Machine Economy</a> which outlined my thoughts about how agentic payments will grow.</p>
<p class="vocs_Paragraph">As onchain payments are still in their infancy, the growth potential here is massive. While Turing-complete blockchains enable programmable payments; the natural integration within the broader internet makes x402 a potential catalyst to bring many businesses onchain.</p>
<p class="vocs_Paragraph">With this potential growth, the only network that is capable of scaling to handle an infinite amount of payments (of any size, including sub-cent) is SKALE. Based on this, I think that a SKALE Chain (of variable sizing) will become a default part for businesses looking to access x402.</p>
<hr class="vocs_HorizontalRule"/>
<!-- -->
<div style="border-top:1px solid #e1e5e9;padding:3rem 0 2rem;margin-top:4rem;text-align:center;max-width:600px;margin-left:auto;margin-right:auto"><div style="font-size:0.95rem;color:#64748b;line-height:1.7;margin-bottom:2rem"><p class="vocs_Paragraph"><strong class="vocs_Strong">Sawyer</strong> (TheGreatAxios) is VP of Developer Success at <a class="vocs_Anchor vocs_Link vocs_Link_accent" href="https://skale.space" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">SKALE</a>,
focused on blockchain infrastructure and developer tooling.
Currently exploring AI agents and x402 protocols.</p></div><div style="display:flex;flex-direction:row;gap:2rem;align-items:center;justify-content:center;font-size:0.9rem;flex-wrap:wrap"><a href="https://x.com/thegreataxios" style="color:#3b82f6;text-decoration:none;font-weight:500;display:flex;align-items:center;gap:0.5rem"><span>ð•</span><span>Connect with me on Twitter</span></a><a href="https://github.com/thegreataxios" style="color:#3b82f6;text-decoration:none;font-weight:500;display:flex;align-items:center;gap:0.5rem"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github" aria-hidden="true"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg></span><span>Checkout my GitHub</span></a><a href="https://buymeacoffee.com/thegreataxios" style="color:#f59e0b;text-decoration:none;font-weight:500;display:flex;align-items:center;gap:0.5rem"><span>â˜•</span><span>Buy me a coffee</span></a></div></div></article><footer class="vocs_Footer" data-layout="minimal"><div class="vocs_Socials"><a class="vocs_Socials_button" href="https://github.com/thegreataxios" target="_blank" rel="noopener noreferrer"><div aria-label="GitHub" class="vocs_Icon vocs_Socials_icon" role="img" style="--vocs_Icon_size:17px"><svg width="100%" height="100%" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="currentColor"></path></svg></div></a><div style="width:1px;margin-top:var(--vocs-space_4);margin-bottom:var(--vocs-space_4);background-color:var(--vocs-color_border)"></div><a class="vocs_Socials_button" href="https://twitter.com/thegreataxios" target="_blank" rel="noopener noreferrer"><div aria-label="X (Twitter)" class="vocs_Icon vocs_Socials_icon" role="img" style="--vocs_Icon_size:16px"><svg width="100%" height="100%" viewBox="0 0 1200 1227" fill="none" xmlns="http://www.w3.org/2000/svg"><title>X</title><path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z" fill="currentColor"></path></svg></div></a></div></footer></div><div data-bottom-observer="true"></div></div></div>
  </body>
</html>
